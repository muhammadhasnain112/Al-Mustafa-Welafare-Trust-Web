<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reports Dashboard - Student Management System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3f37c9;
            --accent-color: #4895ef;
            --light-gray: #f8f9fa;
            --medium-gray: #e9ecef;
            --dark-gray: #495057;
            --success-color: #4bb543;
            --warning-color: #fca311;
            --danger-color: #e63946;
            --info-color: #17a2b8;
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7ff;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }






        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--medium-gray);
        }

        h1 {
            color: var(--primary-color);
            margin: 0;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logout-btn {
            background-color: var(--danger-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logout-btn:hover {
            background-color: #c1121f;
            transform: translateY(-1px);
        }

        .back-btn {
            background-color: var(--medium-gray);
            color: var(--dark-gray);
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-right: 15px;
        }

        .back-btn:hover {
            background-color: var(--dark-gray);
            color: white;
        }

        .controls {
            display: flex;
            margin-bottom: 20px;
            gap: 15px;
            flex-wrap: wrap;
        }

        .filter-btn {
            background-color: white;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .filter-btn:hover {
            background-color: var(--primary-color);
            color: white;
        }

        .date-filter {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .date-filter select, .date-filter input {
            padding: 10px;
            border: 1px solid var(--medium-gray);
            border-radius: 6px;
            background-color: white;
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: var(--shadow-md);
            display: flex;
            align-items: center;
            gap: 15px;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .stat-info {
            flex: 1;
        }

        .stat-title {
            font-size: 0.9rem;
            color: var(--dark-gray);
            margin: 0 0 5px 0;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 600;
            margin: 0;
        }

        .stat-change {
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .stat-change.up {
            color: var(--success-color);
        }

        .stat-change.down {
            color: var(--danger-color);
        }

        .charts-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: var(--shadow-md);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .chart-title {
            font-size: 1.1rem;
            color: var(--dark-gray);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chart-actions {
            display: flex;
            gap: 10px;
        }

        .chart-actions button {
            background: none;
            border: none;
            color: var(--accent-color);
            cursor: pointer;
            font-size: 0.9rem;
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        .tables-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .table-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: var(--shadow-md);
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 500px;
        }

        thead {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }

        th {
            padding: 12px 15px;
            text-align: left;
            font-weight: 500;
        }

        tbody tr {
            border-bottom: 1px solid var(--medium-gray);
            transition: background-color 0.2s;
        }

        tbody tr:hover {
            background-color: var(--light-gray);
        }

        tbody tr:last-child {
            border-bottom: none;
        }

        td {
            padding: 12px 15px;
            color: var(--dark-gray);
        }

        .progress-bar {
            height: 8px;
            background-color: var(--light-gray);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 5px;
        }

        .progress-fill {
            height: 100%;
            border-radius: 4px;
        }

        .message {
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            text-align: center;
        }

        .error-msg {
            background-color: rgba(230, 57, 70, 0.1);
            color: var(--danger-color);
        }

        .success-msg {
            background-color: rgba(75, 181, 67, 0.1);
            color: var(--success-color);
        }

        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            display: inline-block;
        }

        .status-paid {
            background-color: rgba(75, 181, 67, 0.1);
            color: var(--success-color);
        }

        .status-unpaid {
            background-color: rgba(230, 57, 70, 0.1);
            color: var(--danger-color);
        }

        .status-partial {
            background-color: rgba(252, 163, 17, 0.1);
            color: var(--warning-color);
        }

        .status-high {
            background-color: rgba(75, 181, 67, 0.1);
            color: var(--success-color);
        }

        .status-medium {
            background-color: rgba(252, 163, 17, 0.1);
            color: var(--warning-color);
        }

        .status-low {
            background-color: rgba(230, 57, 70, 0.1);
            color: var(--danger-color);
        }



   .analytics-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
 .tables-analytics {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }


   .footer {
            text-align: center;
            padding: 20px;
            border-top: 1px solid var(--medium-gray);
            font-size: 0.9rem;
            color: var(--dark-gray);
        }

        @media (max-width: 1200px) {
            .charts-container, .tables-container {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .stats-container {
                grid-template-columns: 1fr;
            }
            
            header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .date-filter {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-chart-bar"></i> Reports Dashboard</h1>
            <div>
                <button class="back-btn" onclick="window.location.href='dashboard.html'">
                    <i class="fas fa-arrow-left"></i> Back to Dashboard
                </button>
                <!-- <button class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button> -->
            </div>
        </header>

        <div class="controls">
            <button class="filter-btn" onclick="exportToExcel()">
                <i class="fas fa-download"></i> Export to Excel
            </button>
            <div class="date-filter">
                <span>Filter by:</span>
                <select id="timeFilter" onchange="applyFilters()">
                    <option value="all">All Time</option>
                    <option value="today">Today</option>
                    <option value="week">This Week</option>
                    <option value="month">This Month</option>
                    <option value="year">This Year</option>
                </select>
                <input type="date" id="startDate" onchange="applyFilters()">
                <span>to</span>
                <input type="date" id="endDate" onchange="applyFilters()">
            </div>
        </div>

        <div id="message" class="message" style="display: none;"></div>

        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-icon" style="background-color: var(--primary-color);">
                    <i class="fas fa-school"></i>
                </div>
                <div class="stat-info">
                    <p class="stat-title">Total Campuses</p>
                    <p class="stat-value" id="totalCampuses">12</p>
                    <p class="stat-change up">
                        <i class="fas fa-arrow-up"></i> 2 new this month
                    </p>
                </div>
            </div>
            

    <div class="stat-card">
                <div class="stat-icon" style="background-color: var(--warning-color);">
                    <i class="fas fa-book"></i>
                </div>
                <div class="stat-info">
                   <p class="stat-title">Total Courses Offered</p>
                        <p class="stat-value">8</p>
                    <p class="stat-change down">
                        <i class="fas fa-arrow-down"></i> 23.3% of total
                    </p>
                </div>
            </div>



            <div class="stat-card">
                <div class="stat-icon" style="background-color: var(--success-color);">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-info">
                    <p class="stat-title">Total Students</p>
                    <p class="stat-value" id="totalStudents">1,428</p>
                    <p class="stat-change up">
                        <i class="fas fa-arrow-up"></i> 5% from last month
                    </p>
                </div>
            </div>
            



            
            <div class="stat-card">
                <div class="stat-icon" style="background-color: var(--info-color);">
                    <i class="fas fa-money-check"></i>
                </div>
                <div class="stat-info">
                    <p class="stat-title">Fees Paid Students</p>
                    <p class="stat-value" id="paidStudents">1,095</p>
                    <p class="stat-change up">
                        <i class="fas fa-arrow-up"></i> 76.7% of total
                    </p>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon" style="background-color: var(--danger-color);">
                    <i class="fas fa-exclamation-circle"></i>
                </div>
                <div class="stat-info">
                    <p class="stat-title">Unpaid Students</p>
                    <p class="stat-value" id="unpaidStudents">333</p>
                    <p class="stat-change down">
                        <i class="fas fa-arrow-down"></i> 23.3% of total
                    </p>
                </div>
            </div>
        
        </div>

        <div class="tables-container">
            <div class="table-card">
                <div class="chart-header">
                    <h3 class="chart-title"><i class="fas fa-table"></i> Students by Course - Detailed View</h3>
                    <div class="chart-actions">
                        <button onclick="exportTableToExcel('courseTable', 'students-by-course')"><i class="fas fa-download"></i> Export</button>
                    </div>
                </div>
                <div class="table-responsive">
                    <table id="courseTable">
                        <thead>
                            <tr>
                                <th>Course Name</th>
                                <th>Total Students</th>
                                <th>Paid Fees</th>
                                <th>Unpaid Fees</th>
                                <th>Completion Rate</th>
                                <th>Progress</th>
                            </tr>
                        </thead>
                        <tbody id="courseTableBody">
                            <tr>
                                <td>Web Development</td>
                                <td>420</td>
                                <td>350</td>
                                <td>70</td>
                                <td>85%</td>
                                <td>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 85%; background-color: var(--primary-color);"></div>
                                    </div>
                                    <span>85%</span>
                                </td>
                            </tr>
                            <tr>
                                <td>Data Science</td>
                                <td>315</td>
                                <td>250</td>
                                <td>65</td>
                                <td>78%</td>
                                <td>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 78%; background-color: var(--info-color);"></div>
                                    </div>
                                    <span>78%</span>
                                </td>
                            </tr>
                            <tr>
                                <td>Mobile App Development</td>
                                <td>280</td>
                                <td>210</td>
                                <td>70</td>
                                <td>72%</td>
                                <td>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 72%; background-color: var(--success-color);"></div>
                                    </div>
                                    <span>72%</span>
                                </td>
                            </tr>
                            <tr>
                                <td>Graphic Design</td>
                                <td>133</td>
                                <td>95</td>
                                <td>38</td>
                                <td>68%</td>
                                <td>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 68%; background-color: var(--warning-color);"></div>
                                    </div>
                                    <span>68%</span>
                                </td>
                            </tr>
                            <tr>
                                <td>Digital Marketing</td>
                                <td>100</td>
                                <td>70</td>
                                <td>30</td>
                                <td>65%</td>
                                <td>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 65%; background-color: var(--danger-color);"></div>
                                    </div>
                                    <span>65%</span>
                                </td>
                            </tr>
                            <tr>
                                <td>Cloud Computing</td>
                                <td>85</td>
                                <td>75</td>
                                <td>10</td>
                                <td>80%</td>
                                <td>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 80%; background-color: #9c36b5;"></div>
                                    </div>
                                    <span>80%</span>
                                </td>
                            </tr>
                            <tr>
                                <td>Cyber Security</td>
                                <td>65</td>
                                <td>55</td>
                                <td>10</td>
                                <td>75%</td>
                                <td>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 75%; background-color: #17a2b8;"></div>
                                    </div>
                                    <span>75%</span>
                                </td>
                            </tr>
                            <tr>
                                <td>UI/UX Design</td>
                                <td>30</td>
                                <td>25</td>
                                <td>5</td>
                                <td>70%</td>
                                <td>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 70%; background-color: #ff6b6b;"></div>
                                    </div>
                                    <span>70%</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="table-card">
                <div class="chart-header">
                    <h3 class="chart-title"><i class="fas fa-table"></i> Fee Payment Status by Campus</h3>
                    <div class="chart-actions">
                        <button onclick="exportTableToExcel('paymentTable', 'payment-by-campus')"><i class="fas fa-download"></i> Export</button>
                    </div>
                </div>
                <div class="table-responsive">
                    <table id="paymentTable">
                        <thead>
                            <tr>
                                <th>Campus</th>
                                <th>Total Students</th>
                                <th>Paid</th>
                                <th>Unpaid</th>
                                <th>Payment %</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="paymentTableBody">
                            <tr>
                                <td>Main Campus</td>
                                <td>505</td>
                                <td>420</td>
                                <td>85</td>
                                <td>83%</td>
                                <td><span class="status-badge status-high">Excellent</span></td>
                            </tr>
                            <tr>
                                <td>North Campus</td>
                                <td>317</td>
                                <td>245</td>
                                <td>72</td>
                                <td>77%</td>
                                <td><span class="status-badge status-medium">Good</span></td>
                            </tr>
                            <tr>
                                <td>South Campus</td>
                                <td>263</td>
                                <td>198</td>
                                <td>65</td>
                                <td>75%</td>
                                <td><span class="status-badge status-medium">Good</span></td>
                            </tr>
                            <tr>
                                <td>Online</td>
                                <td>163</td>
                                <td>121</td>
                                <td>42</td>
                                <td>74%</td>
                                <td><span class="status-badge status-medium">Average</span></td>
                            </tr>
                            <tr>
                                <td>East Campus</td>
                                <td>120</td>
                                <td>85</td>
                                <td>35</td>
                                <td>71%</td>
                                <td><span class="status-badge status-low">Needs Attention</span></td>
                            </tr>
                            <tr>
                                <td>West Campus</td>
                                <td>60</td>
                                <td>40</td>
                                <td>20</td>
                                <td>67%</td>
                                <td><span class="status-badge status-low">Critical</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>


</div>

<div class="analytics-container">

    
    <div class="tables-analytics">
                <div class="table-card">
                    <div class="chart-header">
                        <h3 class="chart-title"><i class="fas fa-table"></i> Detailed Course Analytics</h3>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Course Name</th>
                                <th>Enrolled Students</th>
                                <th>Completion Rate</th>
                                <th>Avg. Score</th>
                                <th>Pass Rate</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Web Development</td>
                                <td>420</td>
                                <td>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 85%; background-color: #4361ee;"></div>
                                    </div>
                                    <span>85%</span>
                                </td>
                                <td>87.2%</td>
                                <td>92%</td>
                                <td><span class="status-badge status-high">Excellent</span></td>
                            </tr>
                            <tr>
                                <td>Data Science</td>
                                <td>315</td>
                                <td>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 78%; background-color: #4895ef;"></div>
                                    </div>
                                    <span>78%</span>
                                </td>
                                <td>82.5%</td>
                                <td>88%</td>
                                <td><span class="status-badge status-high">Very Good</span></td>
                            </tr>
                            <tr>
                                <td>Mobile App Development</td>
                                <td>280</td>
                                <td>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 72%; background-color: #4bb543;"></div>
                                    </div>
                                    <span>72%</span>
                                </td>
                                <td>79.8%</td>
                                <td>84%</td>
                                <td><span class="status-badge status-medium">Good</span></td>
                            </tr>
                            <tr>
                                <td>Graphic Design</td>
                                <td>133</td>
                                <td>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 68%; background-color: #fca311;"></div>
                                    </div>
                                    <span>68%</span>
                                </td>
                                <td>76.3%</td>
                                <td>81%</td>
                                <td><span class="status-badge status-medium">Satisfactory</span></td>
                            </tr>
                            <tr>
                                <td>Digital Marketing</td>
                                <td>100</td>
                                <td>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 65%; background-color: #e63946;"></div>
                                    </div>
                                    <span>65%</span>
                                </td>
                                <td>74.1%</td>
                                <td>78%</td>
                                <td><span class="status-badge status-medium">Needs Improvement</span></td>
                            </tr>
                            <tr>
                                <td>Cloud Computing</td>
                                <td>85</td>
                                <td>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 80%; background-color: #9c36b5;"></div>
                                    </div>
                                    <span>80%</span>
                                </td>
                                <td>84.2%</td>
                                <td>89%</td>
                                <td><span class="status-badge status-high">Excellent</span></td>
                            </tr>
                            <tr>
                                <td>Cyber Security</td>
                                <td>65</td>
                                <td>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 75%; background-color: #17a2b8;"></div>
                                    </div>
                                    <span>75%</span>
                                </td>
                                <td>81.6%</td>
                                <td>86%</td>
                                <td><span class="status-badge status-high">Very Good</span></td>
                            </tr>
                            <tr>
                                <td>UI/UX Design</td>
                                <td>30</td>
                                <td>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 70%; background-color: #ff6b6b;"></div>
                                    </div>
                                    <span>70%</span>
                                </td>
                                <td>77.9%</td>
                                <td>83%</td>
                                <td><span class="status-badge status-medium">Good</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>


   <div class="footer">
            <p>Â© 2025 Student Management System | Report Generated on: <span id="currentDate"></span></p>
        </div>
    </div>


    <!-- </div> -->

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Set current date
              document.getElementById('currentDate').textContent = new Date().toLocaleDateString('en-US', {
                  year: 'numeric',
                  month: 'long',
                  day: 'numeric'
              });



              
        // Initialize Supabase
        const supabaseUrl = "https://xzypzkjqjcabioedvmzr.supabase.co";
        const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhbmFzZSIsInJlZiI6Inh6eXB6a2pxamNhYmlvZWR2bXpyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMxOTYzOTcsImV4cCI6MjA2ODc3MjM5N30.5Ic571hDQ8iYDfnKg9WCxLTX7VUoLwXxQ967PrRYYW4";
        const supabase = supabase.createClient(supabaseUrl, supabaseKey);






        // DOM elements
        const messageDiv = document.getElementById('message');
        let distributionChart, completionChart;
        
        // Show message function
        function showMessage(message, type) {
            messageDiv.textContent = message;
            messageDiv.className = `message ${type}-msg`;
            messageDiv.style.display = 'block';
            
            // Hide message after 5 seconds
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 5000);
        }
        
        // Logout function
        async function logout() {
            await supabase.auth.signOut();
            window.location.href = 'index.html';
        }
        
        // Apply filters function
        function applyFilters() {
            const timeFilter = document.getElementById('timeFilter').value;
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            // In a real application, you would filter data based on these values
            showMessage(`Filters applied: ${timeFilter}, ${startDate} to ${endDate}`, 'success');
            loadReportData();
        }
        
        // Load report data
        async function loadReportData() {
            try {
                // In a real application, you would fetch this data from Supabase
                // For demonstration, we're using mock data
                
                // Mock data for demonstration
                const reportData = {
                    totalCampuses: 12,
                    totalStudents: 1428,
                    paidStudents: 1095,
                    unpaidStudents: 333,
                    courses: {
                        "Web Development": { total: 420, paid: 350, unpaid: 70, completion: 85 },
                        "Data Science": { total: 315, paid: 250, unpaid: 65, completion: 78 },
                        "Mobile App Development": { total: 280, paid: 210, unpaid: 70, completion: 72 },
                        "Graphic Design": { total: 133, paid: 95, unpaid: 38, completion: 68 },
                        "Digital Marketing": { total: 100, paid: 70, unpaid: 30, completion: 65 },
                        "Cloud Computing": { total: 85, paid: 75, unpaid: 10, completion: 80 },
                        "Cyber Security": { total: 65, paid: 55, unpaid: 10, completion: 75 },
                        "UI/UX Design": { total: 30, paid: 25, unpaid: 5, completion: 70 }
                    },
                    campuses: {
                        "Main Campus": { total: 505, paid: 420, unpaid: 85, percentage: 83, status: "Excellent" },
                        "North Campus": { total: 317, paid: 245, unpaid: 72, percentage: 77, status: "Good" },
                        "South Campus": { total: 263, paid: 198, unpaid: 65, percentage: 75, status: "Good" },
                        "Online": { total: 163, paid: 121, unpaid: 42, percentage: 74, status: "Average" },
                        "East Campus": { total: 120, paid: 85, unpaid: 35, percentage: 71, status: "Needs Attention" },
                        "West Campus": { total: 60, paid: 40, unpaid: 20, percentage: 67, status: "Critical" }
                    }
                };
                
                // Update stats cards
                document.getElementById('totalCampuses').textContent = reportData.totalCampuses;
                document.getElementById('totalStudents').textContent = reportData.totalStudents.toLocaleString();
                document.getElementById('paidStudents').textContent = reportData.paidStudents.toLocaleString();
                document.getElementById('unpaidStudents').textContent = reportData.unpaidStudents.toLocaleString();
                
                // Update course table
                const courseTableBody = document.getElementById('courseTableBody');
                courseTableBody.innerHTML = '';
                
                for (const [course, data] of Object.entries(reportData.courses)) {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${course}</td>
                        <td>${data.total}</td>
                        <td>${data.paid}</td>
                        <td>${data.unpaid}</td>
                        <td>${data.completion}%</td>
                        <td>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${data.completion}%; background-color: ${getColorForPercentage(data.completion)};"></div>
                            </div>
                            <span>${data.completion}%</span>
                        </td>
                    `;
                    courseTableBody.appendChild(row);
                }
                
                // Update payment table
                const paymentTableBody = document.getElementById('paymentTableBody');
                paymentTableBody.innerHTML = '';
                
                for (const [campus, data] of Object.entries(reportData.campuses)) {
                    const statusClass = data.status === "Excellent" ? "status-high" : 
                                      data.status === "Good" ? "status-medium" : 
                                      data.status === "Average" ? "status-partial" : "status-low";
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${campus}</td>
                        <td>${data.total}</td>
                        <td>${data.paid}</td>
                        <td>${data.unpaid}</td>
                        <td>${data.percentage}%</td>
                        <td><span class="status-badge ${statusClass}">${data.status}</span></td>
                    `;
                    paymentTableBody.appendChild(row);
                }
                
                // Initialize charts
                initCharts(reportData);
                
            } catch (error) {
                console.error('Error loading report data:', error);
                showMessage('Error loading report data: ' + error.message, 'error');
            }
        }
        
        // Get color based on percentage
        function getColorForPercentage(percentage) {
            if (percentage >= 80) return '#4361ee'; // Blue
            if (percentage >= 70) return '#4bb543'; // Green
            if (percentage >= 60) return '#fca311'; // Orange
            return '#e63946'; // Red
        }
        
        // Initialize charts
        function initCharts(data) {
            // Distribution Chart
            const distributionCtx = document.getElementById('distributionChart').getContext('2d');
            
            if (distributionChart) {
                distributionChart.destroy();
            }
            
            distributionChart = new Chart(distributionCtx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(data.courses),
                    datasets: [{
                        data: Object.values(data.courses).map(c => c.total),
                        backgroundColor: [
                            '#4361ee', '#4895ef', '#4bb543', '#fca311', 
                            '#e63946', '#9c36b5', '#17a2b8', '#ff6b6b'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                        },
                        title: {
                            display: true,
                            text: 'Student Distribution by Course'
                        }
                    }
                }
            });
            
            // Completion Rate Chart
            const completionCtx = document.getElementById('completionChart').getContext('2d');
            
            if (completionChart) {
                completionChart.destroy();
            }
            
            completionChart = new Chart(completionCtx, {
                type: 'bar',
                data: {
                    labels: Object.keys(data.courses),
                    datasets: [{
                        label: 'Completion Rate %',
                        data: Object.values(data.courses).map(c => c.completion),
                        backgroundColor: [
                            '#4361ee', '#4895ef', '#4bb543', '#fca311', 
                            '#e63946', '#9c36b5', '#17a2b8', '#ff6b6b'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Course Completion Rates'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Completion Rate (%)'
                            }
                        }
                    }
                }
            });
        }
        
        // Export table to Excel
        function exportTableToExcel(tableId, fileName) {
            const table = document.getElementById(tableId);
            const wb = XLSX.utils.table_to_book(table, {sheet: "Sheet1"});
            XLSX.writeFile(wb, `${fileName}-${new Date().toISOString().split('T')[0]}.xlsx`);
            showMessage(`Exported ${fileName} to Excel successfully`, 'success');
        }
        
        // Export chart as image
        function exportChart(chartId, fileName) {
            const chartCanvas = document.getElementById(chartId);
            const link = document.createElement('a');
            link.href = chartCanvas.toDataURL('image/png');
            link.download = `${fileName}-${new Date().toISOString().split('T')[0]}.png`;
            link.click();
            showMessage(`Exported ${fileName} chart as image`, 'success');
        }
        
        // Export all data to Excel
        function exportToExcel() {
            // Create a new workbook
            const wb = XLSX.utils.book_new();
            
            // Add summary sheet
            const summaryData = [
                ["Report Summary", ""],
                ["Generated on", new Date().toLocaleDateString()],
                ["", ""],
                ["Total Campuses", document.getElementById('totalCampuses').textContent],
                ["Total Students", document.getElementById('totalStudents').textContent],
                ["Paid Students", document.getElementById('paidStudents').textContent],
                ["Unpaid Students", document.getElementById('unpaidStudents').textContent]
            ];
            const wsSummary = XLSX.utils.aoa_to_sheet(summaryData);
            XLSX.utils.book_append_sheet(wb, wsSummary, "Summary");
            
            // Add course data sheet
            const courseTable = document.getElementById('courseTable');
            const wsCourse = XLSX.utils.table_to_sheet(courseTable);
            XLSX.utils.book_append_sheet(wb, wsCourse, "Students by Course");
            
            // Add payment data sheet
            const paymentTable = document.getElementById('paymentTable');
            const wsPayment = XLSX.utils.table_to_sheet(paymentTable);
            XLSX.utils.book_append_sheet(wb, wsPayment, "Payment by Campus");
            
            // Save the workbook
            XLSX.writeFile(wb, `student-reports-${new Date().toISOString().split('T')[0]}.xlsx`);
            showMessage('Exported all data to Excel successfully', 'success');
        }
        
        // Check if user is logged in
        async function checkAuth() {
            const { data: { session } } = await supabase.auth.getSession();
            
            if (!session) {
                window.location.href = 'index.html';
                return;
            }
        }
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', async () => {
            await checkAuth();
            await loadReportData();
            
            // Set default date values
            const today = new Date();
            const firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
            
            document.getElementById('startDate').value = firstDayOfMonth.toISOString().split('T')[0];
            document.getElementById('endDate').value = today.toISOString().split('T')[0];
        });
    </script>
</body>
</html>